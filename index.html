<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <style>
        body {
            background-color: black;
            display: flex;
            justify-content: center;
        }
        div {

        }
        table button {
            height: 2rem;
            width: 2rem;
            color: white;
            background-color: blue;
            cursor: pointer
        }
        table button:disabled{
            cursor: not-allowed;
        }
        table button:enabled:hover {
            background-color:darkblue
        }
        #status {
            color: white;
        }
    </style>
</head>
<body>
    <div>
        <p id="status">Player Move</p>
        <table>
            <tr><td><button id="btn0">&nbsp;</button></td><td><button id="btn1">&nbsp;</button></td><td><button id="btn2">&nbsp;</button></td></tr>
            <tr><td><button id="btn3">&nbsp;</button></td><td><button id="btn4">&nbsp;</button></td><td><button id="btn5">&nbsp;</button></td></tr>
            <tr><td><button id="btn6">&nbsp;</button></td><td><button id="btn7">&nbsp;</button></td><td><button id="btn8">&nbsp;</button></td></tr>
        </table>
        <button id="clear">clear</button>
    </div>
</body>
<script>

    let isPlayer = true;
    let btn = [document.getElementById("btn0"), document.getElementById("btn1"), document.getElementById("btn2"), document.getElementById("btn3"), document.getElementById("btn4"), document.getElementById("btn5"), document.getElementById("btn6"), document.getElementById("btn7"), document.getElementById("btn8")];
    let clear = document.getElementById("clear");
    let status = document.getElementById("status"); 
    WebAssembly.instantiateStreaming(fetch("a.out.wasm"))
        .then(wasmIn => {
            let array = new Int8Array(wasmIn.instance.exports.memory.buffer, 0, 9);
            array.fill(32);
            let disableAll = (turn) => {
                isPlayer = !turn;
                for (let i = 0; i< 9; ++i ) { 
                    btn[i].disabled = turn || array[i] != 32;
                }
            }
            for (let i = 0; i< 9; ++i ) {
                btn[i].disabled
                btn[i].addEventListener("click",even => {
                    if (isPlayer) {
                        if (array[i] == 32) {
                            array[i] = 79;
                                    
                            even.target.textContent = "O"
                            even.target.disabled = true;
                            disableAll(true);
                                    
                            if ( wasmIn.instance.exports.isWinner(array, 79)) {
                                status.textContent = "You win!"
                                return;
                            } else if (wasmIn.instance.exports.isBoardFull(array)) {
                                status.textContent = "Is a draw"
                                return;
                            }
                            let comChoice = wasmIn.instance.exports.smartChoice(array, 88);
                            array[comChoice] = 88;
                            btn[comChoice].textContent = "X"
                            btn[comChoice].disabled = true;
                            isPlayer = true;
                            status.textContent = "Computes Move ..."
                            if ( wasmIn.instance.exports.isWinner(array, 88)) {
                                status.textContent ="You lost!";
                                return;
                            } else if (wasmIn.instance.exports.isBoardFull(array)) {
                                status.textContent = "Is a draw"
                                    return;
                            }
                            disableAll(false);
                            status.textContent = "Player Move"
                        }
                    }
                })
            }
            clear.addEventListener("click", ()=> {
                for (let i = 0; i< 9; ++i ) { 
                    btn[i].textContent = "\xA0";
                    btn[i].disabled = false;
                }
                isPlayer = true;
                status.textContent = "Player Move"

                array.fill(32);
            })
})
</script>
</html>